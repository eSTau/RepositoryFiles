
////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ

// Процедура - обработчик события "ПередЗаписью".
//
Процедура ПередЗаписью(Отказ)

	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	/////
	
	Если Наименование <> ИмяФайла Тогда  
		Наименование = ИмяФайла;
	КонецЕсли;
	
	Если ЭтоНовый() Тогда 
		УникальныйИдентификатор = Неопределено;
		Если НЕ ДополнительныеСвойства.Свойство("УникальныйИдентификатор", УникальныйИдентификатор) Тогда 
			УникальныйИдентификатор = Новый УникальныйИдентификатор;
		КонецЕсли;
		УстановитьСсылкуНового(Справочники.ФайлыХранилищаДанных.ПолучитьСсылку(УникальныйИдентификатор));
		Код = Справочники.ФайлыХранилищаДанных.ИД(УникальныйИдентификатор);
	КонецЕсли;
	
	////ДополнительныеСвойства.Вставить("ЭтоНовый", ЭтоНовый());
	ДополнительныеСвойства.Вставить("СсылкаПометкаУдаления", Ссылка.ПометкаУдаления);
	
	////ДополнительныеСвойства.Вставить("СсылкаИмяФайла", Ссылка.ИмяФайла);

КонецПроцедуры

// Процедура - обработчик события "ПриЗаписи".
//
Процедура ПриЗаписи(Отказ)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	/////
	
	////Если ДополнительныеСвойства.Свойство("ЭтоНовый") Тогда 
	////	Если ДополнительныеСвойства.ЭтоНовый Тогда 
	////		Продолжить;
	////	КонецЕсли;
	Если ДополнительныеСвойства.Свойство("СсылкаПометкаУдаления") Тогда 
		Если ЭтотОбъект.ПометкаУдаления <> ДополнительныеСвойства.СсылкаПометкаУдаления Тогда 
			МодульРаботыСФайламиХранилищаДанных.ИзменитьЗначениеИнформационногоПоляЗаписиВнешнегоХранилища(Ссылка, "ПометкаУдаления", ЭтотОбъект.ПометкаУдаления, Отказ);
		КонецЕсли;
	КонецЕсли;	
	
	////КонецЕсли;
	
КонецПроцедуры

// Процедура - обработчик события "ПередУдалением".
//
Процедура ПередУдалением(Отказ)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	/////
	
	Если Тип = Перечисления.ТипыФайловХранилищаДанных.Agreements Тогда // договора
		МодульРаботыСФайламиХранилищаДанных.ИзменитьЗначениеИнформационногоПоляЗаписиВнешнегоХранилища(Ссылка, "ПометкаУдаления", Истина, Отказ);
	Иначе
		МодульРаботыСФайламиХранилищаДанныхСерверВызовСервера.УдалитьДанные(Ссылка, Отказ);
	КонецЕсли;
	
КонецПроцедуры  

